<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Malicious File Finder — v2 + DB</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- ===== ONBOARDING WIZARD ===== -->
    <section
      id="screen-onboard"
      class="panel"
      role="region"
      aria-labelledby="ob-title"
    >
      <h1 id="ob-title" style="text-align: center">Let’s get you ready</h1>

      <div class="ob-wrap">
        <div class="mascot" aria-hidden="true">
          <!-- Friendly shield mascot -->
          <svg viewBox="0 0 120 140" class="mascot-svg">
            <defs>
              <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="#0ea5e9" />
                <stop offset="100%" stop-color="#0369a1" />
              </linearGradient>
            </defs>
            <path
              d="M60 8 L100 24 L100 70 C100 98 84 120 60 130 C36 120 20 98 20 70 L20 24 Z"
              fill="url(#g)"
              stroke="#0c4a6e"
              stroke-width="3"
            />
            <circle class="eye left" cx="46" cy="58" r="6" fill="#0b1220" />
            <circle class="eye right" cx="74" cy="58" r="6" fill="#0b1220" />
            <path
              class="mouth"
              d="M42 80 Q60 92 78 80"
              fill="none"
              stroke="#0b1220"
              stroke-width="3"
              stroke-linecap="round"
            />
          </svg>
        </div>

        <div class="bubble" role="group" aria-live="polite">
          <div id="ob-step-text" class="ob-text">
            Welcome! I’m your helper shield. I’ll show you how to spot tricky
            files.
          </div>
          <ul class="ob-dots" aria-label="Progress">
            <li class="dot active"></li>
            <li class="dot"></li>
            <li class="dot"></li>
            <li class="dot"></li>
            <li class="dot"></li>
          </ul>
          <div class="ob-actions">
            <button id="ob-back" class="menu-btn" disabled>Back</button>
            <button id="ob-next" class="menu-btn primary">Next</button>
            <div
              style="
                margin-left: auto;
                display: flex;
                gap: 10px;
                align-items: center;
              "
            >
              <label class="row small" style="margin: 0">
                <input type="checkbox" id="ob-skip-next" class="checkbox" />
                Don’t show this again
              </label>
              <button id="ob-skip" class="menu-btn ghost">Skip for now</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Skip moved into the onboarding actions row (next to the checkbox) -->
    </section>

    <!-- ===== INTRO SCREEN ===== -->
    <section
      id="screen-intro"
      class="panel hidden"
      role="region"
      aria-labelledby="intro-title"
    >
      <h1 id="intro-title">Welcome to Malicious File Finder</h1>
      <p class="sub">
        Every day, attackers disguise dangerous files as harmless ones. This
        game trains you to spot the red flags—double extensions, macro-enabled
        docs, suspicious archives, and more.
      </p>
      <ul
        class="sub"
        style="
          list-style: disc;
          text-align: left;
          max-width: 760px;
          margin: 12px auto 0;
          padding-left: 22px;
        "
      >
        <li>
          Spot <strong>double extensions</strong> like <code>.pdf.exe</code>.
        </li>
        <li>
          Be cautious with
          <strong>macro-enabled docs</strong> (<code>.docm</code>,
          <code>.xlsm</code>).
        </li>
        <li>
          Quarantine <strong>archives</strong> (<code>.zip</code>,
          <code>.rar</code>) before extracting.
        </li>
        <li>Use the built-in <strong>DB scan</strong> to check known names.</li>
      </ul>

      <!-- Quick glance cards -->
      <div class="intro-grid" aria-label="File types at a glance">
        <div class="intro-card">
          <h3>Executables</h3>
          <p class="note">Programs that run code.</p>
          <p><code>.exe, .msi, .bat, .cmd</code></p>
          <p><strong>Action:</strong> Delete obvious lures; else quarantine.</p>
        </div>
        <div class="intro-card">
          <h3>Macro Docs</h3>
          <p class="note">Office files that can run macros.</p>
          <p><code>.docm, .xlsm</code></p>
          <p>
            <strong>Action:</strong> Quarantine unless you were expecting it.
          </p>
        </div>
        <div class="intro-card">
          <h3>PDFs</h3>
          <p class="note">Documents; lower risk than EXEs.</p>
          <p><code>.pdf</code></p>
          <p>
            <strong>Action:</strong> Approve normal internal docs; verify odd
            ones.
          </p>
        </div>
        <div class="intro-card">
          <h3>Archives</h3>
          <p class="note">Containers that can hide scripts.</p>
          <p><code>.zip, .rar, .7z</code></p>
          <p><strong>Action:</strong> Quarantine and scan before extracting.</p>
        </div>
      </div>

      <div class="row" style="justify-content: center; margin-top: 18px">
        <button id="enter-menu" class="menu-btn primary">Start</button>
      </div>
    </section>

    <!-- ===== MAIN MENU ===== -->
    <section
      id="screen-menu"
      class="panel hidden"
      role="region"
      aria-labelledby="menu-title"
    >
      <h1 id="menu-title">Malicious File Finder</h1>
      <p class="sub">
        Train your eye to spot risky files: double extensions, macro documents,
        suspicious archives, and more.
      </p>

      <div class="col" style="gap: 16px">
        <div class="row">
          <label for="rounds"><strong>Rounds:</strong></label>
          <select id="rounds" class="select">
            <option value="3">3</option>
            <option value="5" selected>5</option>
            <option value="10">10</option>
            <option value="20">20</option>
          </select>
          <label class="row" title="Randomize order of questions">
            <input id="shuffle" type="checkbox" class="checkbox" checked />
            Randomize order
          </label>
          <label class="row" title="Hard mode boosts penalty and adds timer">
            <input id="hardmode" type="checkbox" class="checkbox" />
            Hard mode (timer)
          </label>
          <label class="row" title="Use the internal DB to flag known files">
            <input id="useDb" type="checkbox" class="checkbox" checked />
            Use DB (10–15 files)
          </label>
          <button id="manageDb" class="menu-btn">Manage DB</button>
        </div>

        <fieldset
          style="
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px 12px;
          "
        >
          <legend class="note">Categories</legend>
          <label class="row"
            ><input
              type="checkbox"
              class="checkbox cat"
              value="Executable"
              checked
            />
            Executables</label
          >
          <label class="row"
            ><input
              type="checkbox"
              class="checkbox cat"
              value="Doc (macro)"
              checked
            />
            Macro Docs</label
          >
          <label class="row"
            ><input type="checkbox" class="checkbox cat" value="PDF" checked />
            PDFs</label
          >
          <label class="row"
            ><input
              type="checkbox"
              class="checkbox cat"
              value="Compressed Archive"
              checked
            />
            Archives</label
          >
        </fieldset>

        <div id="quick-tips" class="stat" style="margin-top: 10px">
          <strong>Quick tips:</strong>
          <ul style="margin: 8px 0 0 18px">
            <li>
              When in doubt, quarantine. Approve only if it clearly looks right.
            </li>
            <li>Check for mismatch: name vs. extension vs. size/date.</li>
            <li>Use <em>Scan with DB</em> in-game if you enabled the DB.</li>
          </ul>
        </div>

        <div class="row">
          <button id="start" class="menu-btn primary">Start Training</button>
          <button id="howto" class="menu-btn">How to Play</button>
          <button id="guide" class="menu-btn">File Type Guide</button>
          <button id="import" class="menu-btn ghost">Import JSON</button>
          <input
            id="file-import"
            class="file hidden"
            type="file"
            accept="application/json"
          />
        </div>

        <div class="row" style="justify-content: space-between">
          <p class="note">
            Shortcuts: A=Approve, Q=Quarantine, D=Delete, N or → = Next
          </p>
          <p class="note">High score: <span id="highscore">0</span></p>
        </div>
      </div>
    </section>

    <!-- ===== GAME SCREEN ===== -->
    <section
      id="screen-game"
      class="panel hidden"
      role="region"
      aria-live="polite"
      aria-labelledby="game-title"
    >
      <div class="topbar">
        <h1 id="game-title" style="margin: 0">File Inspector</h1>
        <div class="stats">
          <div><span id="progress">1 / 1</span></div>
          <div>• <span id="score">Score: 0</span></div>
          <div id="timerWrap" class="hidden">
            • <span id="timer" title="Time left for this round">00:20</span>
          </div>
        </div>
      </div>

      <div class="bar" aria-hidden="true">
        <div class="fill" id="progressFill"></div>
      </div>

      <div id="file-info">
        <!-- draggable-file is the element users can drag or keyboard-select -->
        <div id="draggable-file" class="draggable-file" draggable="true" role="button" tabindex="0" aria-grabbed="false" aria-label="Draggable file">
          <img id="file-icon" alt="File type icon" />
          <div id="details">
            <p><strong>Name:</strong> <span id="file-name">—</span></p>
            <p><strong>Size:</strong> <span id="file-size">—</span></p>
            <p><strong>Type:</strong> <span id="file-type">—</span></p>
            <p><strong>Date:</strong> <span id="file-date">—</span></p>
          </div>
        </div>
      </div>

      <div id="actions">
        <div class="drop-target" data-action="approve" aria-label="Drop to Approve" tabindex="0">
          <button class="btn ok" id="approve" aria-keyshortcuts="A">Approve (A)</button>
        </div>

        <div class="drop-target" data-action="quarantine" aria-label="Drop to Quarantine" tabindex="0">
          <button class="btn warn" id="quarantine" aria-keyshortcuts="Q">Quarantine (Q)</button>
        </div>

        <div class="drop-target" data-action="delete" aria-label="Drop to Delete" tabindex="0">
          <button class="btn danger" id="delete" aria-keyshortcuts="D">Delete (D)</button>
        </div>

        <button class="btn" id="next" style="margin-left: auto" aria-keyshortcuts="N,ArrowRight">Next →</button>
        <button class="btn" id="hint">Hint</button>
        <button class="btn" id="scanDb" title="Scan this file against the DB">Scan with DB</button>
      </div>

      <div id="feedback" role="status"></div>
    </section>

    <!-- ===== RESULTS SCREEN ===== -->
    <section
      id="screen-results"
      class="panel hidden"
      role="region"
      aria-labelledby="results-title"
    >
      <h1 id="results-title">Results</h1>
      <div class="results-grid">
        <div class="stat">
          <strong>Final score:</strong> <span id="r-score">0</span>
        </div>
        <div class="stat">
          <strong>Rounds played:</strong> <span id="r-rounds">0</span>
        </div>
        <div class="stat">
          <strong>Correct answers:</strong> <span id="r-correct">0</span>
        </div>
        <div class="stat">
          <strong>Incorrect answers:</strong> <span id="r-wrong">0</span>
        </div>
        <div class="stat">
          <strong>Avg time / round:</strong> <span id="r-avg">—</span>
        </div>
      </div>
      <div style="margin-top: 14px; display: flex; gap: 10px; flex-wrap: wrap">
        <button id="play-again" class="menu-btn primary">Play again</button>
        <button id="back-menu" class="menu-btn">Back to Menu</button>
        <button id="export" class="menu-btn ghost">Export Session JSON</button>
      </div>
    </section>

    <!-- ===== HOW TO PLAY (modal) ===== -->
    <dialog id="modal-how">
      <div class="modal-header">
        <strong>How to Play</strong>
        <button class="close-x" data-close>✕</button>
      </div>
      <div class="modal-body">
        <ol>
          <li>
            Read the file <em>Name</em>, <em>Type</em>, <em>Size</em>, and
            <em>Date</em>.
          </li>
          <li>
            Decide: <strong>Approve</strong> (safe),
            <strong>Quarantine</strong> (needs scanning), or
            <strong>Delete</strong> (clearly malicious).
          </li>
          <li>
            Use shortcuts A / Q / D. Press <strong>Next</strong> (N or →) to
            continue.
          </li>
        </ol>
        <p>
          <em>Scoring:</em> Correct +10 (Approve +5). Wrong −10 (Approve wrong
          −5). In Hard mode, a 20s timer runs; answering with ≥5s left gives a
          +2 bonus.
        </p>
        <p>
          Click <strong>Import JSON</strong> on the main menu to load your own
          questions (array of objects with
          <code>name,size,type,date,icon,correct,explanation</code>).
        </p>
      </div>
    </dialog>

    <!-- ===== FILE TYPE GUIDE (modal) ===== -->
    <dialog id="modal-guide">
      <div class="modal-header">
        <strong>Know Your File Types</strong>
        <button class="close-x" data-close>✕</button>
      </div>
      <div class="modal-body">
        <div class="tabs" role="tablist" aria-label="File type tabs">
          <button
            class="tab active"
            data-tab="tab-exe"
            role="tab"
            aria-selected="true"
          >
            Executables
          </button>
          <button class="tab" data-tab="tab-docm" role="tab">Macro Docs</button>
          <button class="tab" data-tab="tab-pdf" role="tab">PDFs</button>
          <button class="tab" data-tab="tab-zip" role="tab">Archives</button>
        </div>
        <div class="tab-panels">
          <section id="tab-exe" class="tab-panel" role="tabpanel">
            <h3>.exe, .msi, .bat, .cmd, .scr</h3>
            <ul>
              <li>
                <strong>Red flag:</strong> <code>.pdf.exe</code> double
                extension.
              </li>
              <li>
                <strong>Action:</strong> Delete obvious lures; otherwise
                quarantine and scan.
              </li>
              <li>
                <strong>Tip:</strong> Icons and names can lie — trust
                extensions.
              </li>
            </ul>
          </section>
          <section
            id="tab-docm"
            class="tab-panel hidden"
            role="tabpanel"
            aria-hidden="true"
          >
            <h3>.docm, .xlsm (macro-enabled)</h3>
            <ul>
              <li><strong>Risk:</strong> Embedded VBA/macros can run code.</li>
              <li>
                <strong>Action:</strong> Quarantine unless expected from a
                trusted source.
              </li>
              <li><strong>Tip:</strong> Beware “Enable Content” prompts.</li>
            </ul>
          </section>
          <section
            id="tab-pdf"
            class="tab-panel hidden"
            role="tabpanel"
            aria-hidden="true"
          >
            <h3>.pdf</h3>
            <ul>
              <li>
                <strong>Risk:</strong> Can contain links/embedded files; lower
                risk than EXEs.
              </li>
              <li>
                <strong>Action:</strong> Approve normal internal docs; verify
                unexpected senders.
              </li>
              <li>
                <strong>Tip:</strong> Watch for odd sizes/dates and spoofed
                names.
              </li>
            </ul>
          </section>
          <section
            id="tab-zip"
            class="tab-panel hidden"
            role="tabpanel"
            aria-hidden="true"
          >
            <h3>.zip, .rar, .7z</h3>
            <ul>
              <li><strong>Risk:</strong> May hide scripts or EXEs inside.</li>
              <li>
                <strong>Action:</strong> Quarantine and scan before extracting.
              </li>
              <li>
                <strong>Tip:</strong> “Photos.zip” + invoice terms = extra sus.
              </li>
            </ul>
          </section>
        </div>
      </div>
    </dialog>

    <script src="script.js"></script>
  </body>
</html>
